<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xsukax EN-AR Offline Translator</title>
    <style>
        :root { --bg: #0a0a0a; --surface: #1a1a1a; --border: #333; --text: #00ff41; --text-secondary: #888; --accent: #00ff41; --error: #ff4444; --warning: #ffaa00; --success: #00ff41; --info: #44aaff; --quality: #ff6b9d; }
        :root.light { --bg: #ffffff; --surface: #f5f5f5; --border: #ccc; --text: #333; --text-secondary: #666; --accent: #007acc; --error: #cc0000; --warning: #cc8800; --success: #008800; --info: #0066cc; --quality: #d63384; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Courier New', Monaco, monospace; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; transition: all 0.3s ease; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { margin-bottom: 25px; }
        .header-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .title { font-size: 24px; color: var(--accent); }
        .brand { font-weight: bold; color: var(--accent); }
        .subtitle { color: var(--text-secondary); font-size: 14px; margin-top: 5px; }
        .version-badge { background: var(--success); color: var(--bg); padding: 2px 6px; font-size: 10px; margin-left: 8px; }
        .theme-toggle { background: var(--surface); border: 1px solid var(--border); color: var(--text); padding: 8px 12px; cursor: pointer; font-family: inherit; transition: all 0.2s ease; }
        .theme-toggle:hover { background: var(--accent); color: var(--bg); }
        .fixes-bar { background: var(--surface); border: 1px solid var(--success); color: var(--success); padding: 10px 15px; margin-bottom: 20px; font-size: 11px; }
        .fixes-list { display: flex; gap: 20px; margin-top: 5px; flex-wrap: wrap; }
        .fix-item { display: flex; align-items: center; gap: 5px; }
        .fix-dot { width: 4px; height: 4px; background: var(--success); }
        .status-bar { background: var(--surface); border: 1px solid var(--border); padding: 10px 15px; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; }
        .status-info { display: flex; align-items: center; }
        .status-bar.online { border-color: var(--success); }
        .status-bar.offline { border-color: var(--error); }
        .status-dot { width: 8px; height: 8px; background: var(--error); margin-right: 10px; }
        .status-bar.online .status-dot { background: var(--success); }
        .status-details { font-size: 11px; color: var(--text-secondary); }
        .main-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; margin-bottom: 20px; }
        .text-section { display: flex; flex-direction: column; }
        .text-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .text-label { color: var(--text-secondary); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
        .copy-btn { background: var(--surface); border: 1px solid var(--border); color: var(--text-secondary); padding: 4px 8px; cursor: pointer; font-family: inherit; font-size: 10px; transition: all 0.2s ease; }
        .copy-btn:hover:not(:disabled) { background: var(--accent); color: var(--bg); }
        .copy-btn:active { transform: scale(0.95); }
        .copy-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .text-input { background: var(--surface); border: 1px solid var(--border); color: var(--text); padding: 15px; min-height: 200px; font-family: inherit; font-size: 14px; resize: vertical; transition: border-color 0.2s ease; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word; }
        .text-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 2px rgba(0, 255, 65, 0.1); }
        .text-input:readonly { opacity: 0.9; }
        .text-input::placeholder { color: var(--text-secondary); opacity: 0.7; white-space: pre-wrap; }
        .text-stats { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary); margin-top: 5px; align-items: center; flex-wrap: wrap; gap: 10px; }
        .char-count { }
        .structure-info { color: var(--info); }
        .quality-indicator { color: var(--quality); }
        .controls { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; }
        .direction-tabs { display: flex; border: 1px solid var(--border); }
        .direction-tab { background: var(--surface); border: none; border-right: 1px solid var(--border); color: var(--text-secondary); padding: 12px 24px; cursor: pointer; font-family: inherit; font-size: 12px; transition: all 0.2s ease; }
        .direction-tab:last-child { border-right: none; }
        .direction-tab.active { background: var(--accent); color: var(--bg); }
        .direction-tab:hover:not(.active) { background: var(--border); }
        .swap-btn { background: var(--surface); border: 1px solid var(--border); color: var(--text); width: 45px; height: 45px; cursor: pointer; font-size: 18px; transition: all 0.2s ease; }
        .swap-btn:hover { background: var(--accent); color: var(--bg); transform: rotate(180deg); }
        .action-bar { text-align: center; }
        .translate-btn { background: var(--accent); color: var(--bg); border: none; padding: 15px 35px; cursor: pointer; font-family: inherit; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; transition: all 0.2s ease; font-weight: bold; }
        .translate-btn:hover:not(:disabled) { opacity: 0.9; transform: translateY(-1px); }
        .translate-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .loading { display: none; text-align: center; margin-top: 15px; color: var(--warning); font-size: 12px; }
        .loading.show { display: block; }
        .progress-info { color: var(--text-secondary); font-size: 11px; margin-top: 5px; }
        .progress-details { color: var(--info); font-size: 10px; margin-top: 3px; }
        .error { background: var(--surface); border: 1px solid var(--error); color: var(--error); padding: 15px; margin-top: 15px; display: none; font-size: 12px; }
        .error.show { display: block; }
        .success { background: var(--surface); border: 1px solid var(--success); color: var(--success); padding: 10px 15px; margin-top: 10px; display: none; font-size: 11px; }
        .success.show { display: block; }
        .quality-report { background: var(--surface); border: 1px solid var(--quality); color: var(--quality); padding: 10px 15px; margin-top: 10px; display: none; font-size: 11px; }
        .quality-report.show { display: block; }
        .quality-metrics { display: flex; gap: 15px; margin-top: 5px; flex-wrap: wrap; }
        .metric { display: flex; align-items: center; gap: 5px; }
        .metric-dot { width: 4px; height: 4px; background: var(--quality); }
        .footer { border-top: 1px solid var(--border); margin-top: 30px; padding-top: 15px; text-align: center; color: var(--text-secondary); font-size: 11px; display: flex; justify-content: space-between; align-items: center; }
        .terminal-prompt::before { content: '> '; color: var(--accent); }
        .brand-info { display: flex; align-items: center; gap: 15px; }
        .version { color: var(--text-secondary); font-size: 10px; }
        @media (max-width: 768px) { .main-grid { grid-template-columns: 1fr; } .controls { order: -1; } .header-row { flex-direction: column; gap: 10px; text-align: center; } .footer { flex-direction: column; gap: 10px; } .fixes-list { flex-direction: column; gap: 5px; } .quality-metrics { flex-direction: column; gap: 5px; } .text-stats { flex-direction: column; align-items: flex-start; gap: 5px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-row">
                <div>
                    <div class="title terminal-prompt">
                        <span class="brand">xsukax</span> EN-AR TRANSLATOR
                        <span class="version-badge">v2.2</span>
                    </div>
                    <div class="subtitle">No Internet Required</div>
                </div>
                <button id="themeToggle" class="theme-toggle">DARK</button>
            </div>
        </div>

        <div id="status" class="status-bar offline">
            <div class="status-info">
                <div class="status-dot"></div>
                <div>
                    <div><span id="statusText">CHECKING CONNECTION...</span></div>
                    <div class="status-details" id="statusDetails">Initializing xsukax Offline Translator ...</div>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="text-section">
                <div class="text-header">
                    <div class="text-label">SOURCE TEXT</div>
                    <button class="copy-btn" id="copyInput" title="Copy source text">COPY</button>
                </div>
                <textarea id="inputText" class="text-input" placeholder="Enter your text here (up to 10000 characters)" maxlength="10000"></textarea>
                <div class="text-stats">
                    <div class="char-count"><span id="charCount">0</span>/10000 chars</div>
                    <div class="structure-info" id="structureInfo"></div>
                    <div class="quality-indicator" id="qualityPreview"></div>
                </div>
            </div>

            <div class="controls">
                <div class="direction-tabs">
                    <button class="direction-tab active" data-direction="en-ar">EN→AR</button>
                    <button class="direction-tab" data-direction="ar-en">AR→EN</button>
                </div>
                <button class="swap-btn" title="Swap languages and text content">⇄</button>
            </div>

            <div class="text-section">
                <div class="text-header">
                    <div class="text-label">TRANSLATION OUTPUT</div>
                    <button class="copy-btn" id="copyOutput" title="Copy translation" disabled>COPY</button>
                </div>
                <textarea id="outputText" class="text-input" placeholder="Complete translation will appear here" readonly></textarea>
                <div class="text-stats">
                    <div class="char-count"><span id="outputCharCount">0</span> chars</div>
                    <div class="quality-indicator" id="outputQuality"></div>
                </div>
            </div>
        </div>

        <div class="action-bar">
            <button id="translateBtn" class="translate-btn">TRANSLATE</button>
        </div>

        <div id="loading" class="loading">
            <div class="terminal-prompt">TRANSLATING...</div>
            <div class="progress-info" id="progressInfo"></div>
        </div>

        <div id="error" class="error"></div>
        <div id="success" class="success"></div>
        <div id="qualityReport" class="quality-report"></div>

        <div class="footer">
            <div class="brand-info">
                <div class="terminal-prompt">xsukax EN-AR Offline Translator</div>
                <div class="version">v2.2 | Complete • Clean • Professional</div>
            </div>
            <div>No Mixed Languages • Perfect Formatting • Quality Assured • Offline</div>
        </div>
    </div>

    <script>
        class XsukaxFixedTranslator {
            constructor() {
                this.apiUrl = 'http://localhost:5000';
                this.currentDirection = 'en-ar';
                this.theme = localStorage.getItem('xsukax-theme') || 'dark';
                this.init();
            }

            init() {
                this.setTheme(this.theme);
                this.bindEvents();
                this.checkApiStatus();
                this.updateCharacterCount();
                this.analyzeTextStructure();
                
                setInterval(() => this.checkApiStatus(), 30000);
            }

            setTheme(theme) {
                this.theme = theme;
                const root = document.documentElement;
                const toggleBtn = document.getElementById('themeToggle');
                
                if (theme === 'light') {
                    root.classList.add('light');
                    toggleBtn.textContent = 'LIGHT';
                } else {
                    root.classList.remove('light');
                    toggleBtn.textContent = 'DARK';
                }
                
                localStorage.setItem('xsukax-theme', theme);
            }

            bindEvents() {
                document.getElementById('themeToggle').addEventListener('click', () => {
                    this.setTheme(this.theme === 'dark' ? 'light' : 'dark');
                });

                document.querySelectorAll('.direction-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.direction-tab').forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentDirection = e.target.dataset.direction;
                        this.analyzeTextStructure();
                    });
                });

                document.querySelector('.swap-btn').addEventListener('click', () => {
                    this.swapLanguages();
                });

                document.getElementById('translateBtn').addEventListener('click', () => {
                    this.translate();
                });

                document.getElementById('inputText').addEventListener('input', () => {
                    this.updateCharacterCount();
                    this.analyzeTextStructure();
                });

                document.getElementById('inputText').addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        this.translate();
                    }
                });

                // Copy buttons
                document.getElementById('copyInput').addEventListener('click', () => {
                    this.copyToClipboard('inputText', 'SOURCE TEXT COPIED TO CLIPBOARD');
                });

                document.getElementById('copyOutput').addEventListener('click', () => {
                    this.copyToClipboard('outputText', 'TRANSLATION COPIED TO CLIPBOARD');
                });
            }

            analyzeTextStructure() {
                const inputText = document.getElementById('inputText').value;
                const structureInfo = document.getElementById('structureInfo');
                const qualityPreview = document.getElementById('qualityPreview');
                
                if (!inputText.trim()) {
                    structureInfo.textContent = '';
                    qualityPreview.textContent = '';
                    return;
                }

                // Analyze structure
                const paragraphs = inputText.split('\n\n').filter(p => p.trim()).length;
                const lines = inputText.split('\n').length;
                const sentences = inputText.split(/[.!?؟।]+/).filter(s => s.trim()).length;
                
                if (paragraphs > 1) {
                    structureInfo.textContent = `${paragraphs} paragraphs, ${sentences} sentences`;
                } else {
                    structureInfo.textContent = `${sentences} sentences, ${lines} lines`;
                }

                // Quality preview
                if (inputText.length > 300) {
                    const estimatedChunks = Math.ceil(inputText.length / 300);
                    qualityPreview.textContent = `~${estimatedChunks} chunks, quality assured`;
                } else {
                    qualityPreview.textContent = 'single chunk, optimal quality';
                }
            }

            async copyToClipboard(textareaId, successMessage) {
                const textarea = document.getElementById(textareaId);
                const text = textarea.value;
                
                if (!text.trim()) {
                    this.showMessage('NO TEXT TO COPY', 'error');
                    return;
                }

                try {
                    await navigator.clipboard.writeText(text);
                    this.showMessage(successMessage, 'success');
                } catch (err) {
                    // Fallback for older browsers
                    textarea.select();
                    textarea.setSelectionRange(0, 99999);
                    document.execCommand('copy');
                    this.showMessage(successMessage, 'success');
                }
            }

            async checkApiStatus() {
                try {
                    const response = await fetch(`${this.apiUrl}/health`);
                    const data = await response.json();
                    
                    if (data.healthy && data.models_loaded) {
                        this.updateStatus(true, 'API ONLINE');
                    } else {
                        this.updateStatus(false, 'API ONLINE - MODELS NOT LOADED', 'Restart translator_api.py');
                    }
                } catch (error) {
                    this.updateStatus(false, 'API OFFLINE', 'Start translator_api.py to begin translation');
                }
            }

            updateStatus(online, message, details) {
                const statusEl = document.getElementById('status');
                const statusText = document.getElementById('statusText');
                const statusDetails = document.getElementById('statusDetails');
                const translateBtn = document.getElementById('translateBtn');
                
                if (online) {
                    statusEl.className = 'status-bar online';
                    translateBtn.disabled = false;
                } else {
                    statusEl.className = 'status-bar offline';
                    translateBtn.disabled = true;
                }
                
                statusText.textContent = message;
                statusDetails.textContent = details;
            }

            updateCharacterCount() {
                const inputText = document.getElementById('inputText');
                const outputText = document.getElementById('outputText');
                const charCount = document.getElementById('charCount');
                const outputCharCount = document.getElementById('outputCharCount');
                const copyOutput = document.getElementById('copyOutput');
                
                charCount.textContent = inputText.value.length;
                outputCharCount.textContent = outputText.value.length;
                
                // Enable/disable copy output button
                copyOutput.disabled = outputText.value.length === 0;
                
                // Update output quality indicator
                const outputQuality = document.getElementById('outputQuality');
                if (outputText.value) {
                    const paragraphs = outputText.value.split('\n\n').filter(p => p.trim()).length;
                    outputQuality.textContent = `${paragraphs} paragraph${paragraphs > 1 ? 's' : ''}, perfect formatting`;
                } else {
                    outputQuality.textContent = '';
                }
            }

            swapLanguages() {
                const inputText = document.getElementById('inputText');
                const outputText = document.getElementById('outputText');
                
                const tempText = inputText.value;
                inputText.value = outputText.value;
                outputText.value = tempText;
                
                this.currentDirection = this.currentDirection === 'en-ar' ? 'ar-en' : 'en-ar';
                
                document.querySelectorAll('.direction-tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.direction === this.currentDirection) {
                        tab.classList.add('active');
                    }
                });
                
                this.updateCharacterCount();
                this.analyzeTextStructure();
            }

            async translate() {
                const inputText = document.getElementById('inputText').value;
                const outputText = document.getElementById('outputText');
                const translateBtn = document.getElementById('translateBtn');
                const loading = document.getElementById('loading');
                const progressInfo = document.getElementById('progressInfo');
                const progressDetails = document.getElementById('progressDetails');
                const error = document.getElementById('error');
                const success = document.getElementById('success');
                const qualityReport = document.getElementById('qualityReport');

                if (!inputText.trim()) {
                    this.showMessage('ERROR: NO INPUT TEXT PROVIDED', 'error');
                    return;
                }

                // Clear previous results
                loading.classList.add('show');
                translateBtn.disabled = true;
                error.classList.remove('show');
                success.classList.remove('show');
                qualityReport.classList.remove('show');
                outputText.value = '';
                
                // Show detailed progress
                const paragraphs = inputText.split('\n\n').filter(p => p.trim()).length;
                const estimatedChunks = Math.ceil(inputText.length / 300);
                
                progressInfo.textContent = `Processing ${paragraphs} paragraph${paragraphs > 1 ? 's' : ''} in ${estimatedChunks} chunk${estimatedChunks > 1 ? 's' : ''}...`;

                try {
                    const response = await fetch(`${this.apiUrl}/translate`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            text: inputText,
                            direction: this.currentDirection
                        })
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                        // Set the translation
                        outputText.value = data.translated_text;
                        this.updateCharacterCount();
                        
                        // Show success with quality metrics
                        let successMsg = 'TRANSLATION COMPLETED PERFECTLY';
                        this.showMessage(successMsg, 'success');
                        
                        // Show quality report
                        this.showQualityReport(data);
                        
                    } else {
                        throw new Error(data.error || 'TRANSLATION FAILED');
                    }

                } catch (err) {
                    this.showMessage(`ERROR: ${err.message.toUpperCase()}`, 'error');
                } finally {
                    loading.classList.remove('show');
                    translateBtn.disabled = false;
                    progressInfo.textContent = '';
                    progressDetails.textContent = '';
                }
            }

            showQualityReport(data) {
                const qualityReport = document.getElementById('qualityReport');
                
                let reportHtml = '<div class="terminal-prompt">QUALITY REPORT</div>';
                reportHtml += '<div class="quality-metrics">';
                
                if (data.complete_translation !== false) {
                    reportHtml += '<div class="metric"><div class="metric-dot"></div>Complete translation</div>';
                }
                
                if (data.mixed_languages === false) {
                    reportHtml += '<div class="metric"><div class="metric-dot"></div>No mixed languages</div>';
                }
                
                if (data.formatting_preserved) {
                    reportHtml += '<div class="metric"><div class="metric-dot"></div>Formatting preserved</div>';
                }
                
                if (data.paragraphs_processed) {
                    reportHtml += `<div class="metric"><div class="metric-dot"></div>${data.paragraphs_processed} paragraphs processed</div>`;
                }
                
                if (data.chunks_processed) {
                    reportHtml += `<div class="metric"><div class="metric-dot"></div>${data.chunks_processed} chunks processed</div>`;
                }
                
                reportHtml += '</div>';
                
                qualityReport.innerHTML = reportHtml;
                qualityReport.classList.add('show');
                
                setTimeout(() => {
                    qualityReport.classList.remove('show');
                }, 8000);
            }

            showMessage(message, type) {
                const element = document.getElementById(type);
                element.textContent = type === 'error' ? `> ${message}` : `> ${message}`;
                element.classList.add('show');
                
                setTimeout(() => {
                    element.classList.remove('show');
                }, type === 'success' ? 5000 : 7000);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new XsukaxFixedTranslator();
        });
    </script>
</body>
</html>